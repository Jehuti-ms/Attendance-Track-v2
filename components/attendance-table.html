<div class="attendance-table-container" data-component="attendance-table">
    <div class="table-header">
        <div class="header-left">
            <h3 class="table-title" id="table-title">Attendance Records</h3>
            <div class="table-subtitle" id="table-subtitle">
                Showing <span id="record-count">0</span> records
            </div>
        </div>
        <div class="header-right">
            <div class="table-controls">
                <div class="search-box">
                    <input type="text" id="attendance-search" placeholder="Search records..." 
                           class="search-input">
                    <i class="icon-search"></i>
                </div>
                <div class="filter-dropdown">
                    <button class="filter-btn" id="filter-btn">
                        <i class="icon-filter"></i>
                        Filter
                        <span class="filter-badge" id="filter-badge">0</span>
                    </button>
                    <div class="filter-menu" id="filter-menu">
                        <div class="filter-section">
                            <h4>Status</h4>
                            <label class="filter-option">
                                <input type="checkbox" name="status" value="present" checked>
                                <span>Present</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="status" value="absent" checked>
                                <span>Absent</span>
                            </label>
                            <label class="filter-option">
                                <input type="checkbox" name="status" value="late" checked>
                                <span>Late</span>
                            </label>
                        </div>
                        <div class="filter-section">
                            <h4>Date Range</h4>
                            <div class="date-inputs">
                                <input type="date" id="date-from" class="date-input">
                                <span>to</span>
                                <input type="date" id="date-to" class="date-input">
                            </div>
                        </div>
                        <div class="filter-actions">
                            <button class="btn btn-sm btn-secondary" id="clear-filters">Clear</button>
                            <button class="btn btn-sm btn-primary" id="apply-filters">Apply</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" id="add-record-btn">
                    <i class="icon-add"></i>
                    Add Record
                </button>
            </div>
        </div>
    </div>
    
    <div class="table-wrapper">
        <table class="attendance-table" id="attendance-table">
            <thead>
                <tr>
                    <th class="select-col">
                        <label class="checkbox">
                            <input type="checkbox" id="select-all">
                            <span></span>
                        </label>
                    </th>
                    <th class="name-col">
                        <button class="sortable-header" data-sort="name">
                            Name
                            <i class="icon-sort"></i>
                        </button>
                    </th>
                    <th class="date-col">
                        <button class="sortable-header" data-sort="date">
                            Date
                            <i class="icon-sort"></i>
                        </button>
                    </th>
                    <th class="time-col">
                        <button class="sortable-header" data-sort="time">
                            Time
                            <i class="icon-sort"></i>
                        </button>
                    </th>
                    <th class="status-col">
                        <button class="sortable-header" data-sort="status">
                            Status
                            <i class="icon-sort"></i>
                        </button>
                    </th>
                    <th class="notes-col">Notes</th>
                    <th class="actions-col">Actions</th>
                </tr>
            </thead>
            <tbody id="attendance-tbody">
                <!-- Records will be populated dynamically -->
                <tr class="empty-row">
                    <td colspan="7">
                        <div class="empty-state">
                            <i class="icon-empty"></i>
                            <p>No attendance records found</p>
                            <button class="btn btn-primary" id="add-first-record">Add First Record</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="table-footer">
        <div class="footer-left">
            <div class="selected-count" id="selected-count">
                <span>0</span> selected
            </div>
            <div class="bulk-actions" id="bulk-actions">
                <button class="btn btn-sm btn-secondary" id="bulk-edit">
                    <i class="icon-edit"></i>
                    Edit
                </button>
                <button class="btn btn-sm btn-secondary" id="bulk-delete">
                    <i class="icon-delete"></i>
                    Delete
                </button>
                <button class="btn btn-sm btn-secondary" id="bulk-export">
                    <i class="icon-export"></i>
                    Export
                </button>
            </div>
        </div>
        <div class="footer-right">
            <div class="pagination">
                <button class="pagination-btn" id="prev-page" disabled>
                    <i class="icon-chevron-left"></i>
                </button>
                <div class="page-info">
                    Page <span id="current-page">1</span> of <span id="total-pages">1</span>
                </div>
                <button class="pagination-btn" id="next-page" disabled>
                    <i class="icon-chevron-right"></i>
                </button>
                <select class="page-size-select" id="page-size">
                    <option value="10">10 per page</option>
                    <option value="25">25 per page</option>
                    <option value="50">50 per page</option>
                    <option value="100">100 per page</option>
                </select>
            </div>
        </div>
    </div>
</div>

<script>
    // Attendance table component
    class AttendanceTable {
        constructor(options = {}) {
            this.options = {
                selectable: true,
                editable: true,
                pageable: true,
                filterable: true,
                ...options
            };
            
            this.currentPage = 1;
            this.pageSize = 10;
            this.totalRecords = 0;
            this.selectedRecords = new Set();
            this.sortColumn = null;
            this.sortDirection = 'asc';
            this.filters = {};
            
            this.initializeElements();
            this.bindEvents();
            this.loadData();
        }
        
        initializeElements() {
            this.elements = {
                tableBody: document.getElementById('attendance-tbody'),
                selectAll: document.getElementById('select-all'),
                searchInput: document.getElementById('attendance-search'),
                filterBtn: document.getElementById('filter-btn'),
                filterMenu: document.getElementById('filter-menu'),
                filterBadge: document.getElementById('filter-badge'),
                addRecordBtn: document.getElementById('add-record-btn'),
                selectedCount: document.getElementById('selected-count'),
                bulkActions: document.getElementById('bulk-actions'),
                prevPage: document.getElementById('prev-page'),
                nextPage: document.getElementById('next-page'),
                currentPage: document.getElementById('current-page'),
                totalPages: document.getElementById('total-pages'),
                pageSize: document.getElementById('page-size'),
                recordCount: document.getElementById('record-count'),
                clearFilters: document.getElementById('clear-filters'),
                applyFilters: document.getElementById('apply-filters')
            };
        }
        
        bindEvents() {
            // Select all checkbox
            this.elements.selectAll?.addEventListener('change', (e) => {
                this.toggleSelectAll(e.target.checked);
            });
            
            // Search input
            this.elements.searchInput?.addEventListener('input', (e) => {
                this.debouncedSearch(e.target.value);
            });
            
            // Filter button
            this.elements.filterBtn?.addEventListener('click', (e) => {
                e.stopPropagation();
                this.elements.filterMenu.classList.toggle('show');
            });
            
            // Close filter menu when clicking outside
            document.addEventListener('click', () => {
                this.elements.filterMenu.classList.remove('show');
            });
            
            // Add record button
            this.elements.addRecordBtn?.addEventListener('click', () => {
                this.openAddRecordModal();
            });
            
            // Pagination
            this.elements.prevPage?.addEventListener('click', () => {
                this.previousPage();
            });
            
            this.elements.nextPage?.addEventListener('click', () => {
                this.nextPage();
            });
            
            this.elements.pageSize?.addEventListener('change', (e) => {
                this.pageSize = parseInt(e.target.value);
                this.currentPage = 1;
                this.loadData();
            });
            
            // Filter actions
            this.elements.clearFilters?.addEventListener('click', () => {
                this.clearAllFilters();
            });
            
            this.elements.applyFilters?.addEventListener('click', () => {
                this.applyCurrentFilters();
            });
            
            // Sortable headers
            document.querySelectorAll('.sortable-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    const column = e.currentTarget.dataset.sort;
                    this.sortBy(column);
                });
            });
            
            // Bulk actions
            document.getElementById('bulk-edit')?.addEventListener('click', () => {
                this.bulkEdit();
            });
            
            document.getElementById('bulk-delete')?.addEventListener('click', () => {
                this.bulkDelete();
            });
            
            document.getElementById('bulk-export')?.addEventListener('click', () => {
                this.bulkExport();
            });
        }
        
        async loadData() {
            try {
                // In a real app, this would fetch from IndexedDB with pagination
                const data = await this.fetchAttendanceData();
                this.totalRecords = data.length;
                this.renderTable(data);
                this.updatePagination();
                this.updateRecordCount();
            } catch (error) {
                console.error('Error loading attendance data:', error);
                this.showErrorState();
            }
        }
        
        async fetchAttendanceData() {
            // This is a placeholder - implement with your IndexedDB logic
            return [];
        }
        
        renderTable(records) {
            const tbody = this.elements.tableBody;
            
            if (records.length === 0) {
                tbody.innerHTML = `
                    <tr class="empty-row">
                        <td colspan="7">
                            <div class="empty-state">
                                <i class="icon-empty"></i>
                                <p>No attendance records found</p>
                                <button class="btn btn-primary" id="add-first-record">Add First Record</button>
                            </div>
                        </td>
                    </tr>
                `;
                
                document.getElementById('add-first-record')?.addEventListener('click', () => {
                    this.openAddRecordModal();
                });
                
                return;
            }
            
            let html = '';
            records.forEach((record, index) => {
                const isSelected = this.selectedRecords.has(record.id);
                html += `
                    <tr data-record-id="${record.id}" class="${isSelected ? 'selected' : ''}">
                        <td class="select-col">
                            <label class="checkbox">
                                <input type="checkbox" class="record-select" 
                                       data-id="${record.id}" ${isSelected ? 'checked' : ''}>
                                <span></span>
                            </label>
                        </td>
                        <td class="name-col">${this.escapeHtml(record.name)}</td>
                        <td class="date-col">${this.formatDate(record.date)}</td>
                        <td class="time-col">${this.formatTime(record.time)}</td>
                        <td class="status-col">
                            <span class="status-badge ${record.status}">
                                ${record.status.charAt(0).toUpperCase() + record.status.slice(1)}
                            </span>
                        </td>
                        <td class="notes-col">${this.escapeHtml(record.notes || '-')}</td>
                        <td class="actions-col">
                            <div class="action-buttons">
                                <button class="btn-icon btn-edit" data-id="${record.id}" title="Edit">
                                    <i class="icon-edit"></i>
                                </button>
                                <button class="btn-icon btn-delete" data-id="${record.id}" title="Delete">
                                    <i class="icon-delete"></i>
                                </button>
                                <button class="btn-icon btn-view" data-id="${record.id}" title="View Details">
                                    <i class="icon-eye"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            
            // Add event listeners to checkboxes
            tbody.querySelectorAll('.record-select').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    this.toggleRecordSelection(e.target.dataset.id, e.target.checked);
                });
            });
            
            // Add event listeners to action buttons
            tbody.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    this.editRecord(e.target.closest('.btn-edit').dataset.id);
                });
            });
            
            tbody.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    this.deleteRecord(e.target.closest('.btn-delete').dataset.id);
                });
            });
            
            tbody.querySelectorAll('.btn-view').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    this.viewRecord(e.target.closest('.btn-view').dataset.id);
                });
            });
        }
        
        toggleSelectAll(select) {
            const checkboxes = this.elements.tableBody.querySelectorAll('.record-select');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = select;
                const recordId = checkbox.dataset.id;
                
                if (select) {
                    this.selectedRecords.add(recordId);
                } else {
                    this.selectedRecords.delete(recordId);
                }
            });
            
            this.updateSelectionUI();
        }
        
        toggleRecordSelection(recordId, selected) {
            if (selected) {
                this.selectedRecords.add(recordId);
            } else {
                this.selectedRecords.delete(recordId);
                this.elements.selectAll.checked = false;
            }
            
            this.updateSelectionUI();
        }
        
        updateSelectionUI() {
            const count = this.selectedRecords.size;
            this.elements.selectedCount.innerHTML = `<span>${count}</span> selected`;
            this.elements.bulkActions.style.display = count > 0 ? 'flex' : 'none';
        }
        
        updatePagination() {
            const totalPages = Math.ceil(this.totalRecords / this.pageSize);
            
            this.elements.currentPage.textContent = this.currentPage;
            this.elements.totalPages.textContent = totalPages;
            this.elements.prevPage.disabled = this.currentPage <= 1;
            this.elements.nextPage.disabled = this.currentPage >= totalPages;
        }
        
        updateRecordCount() {
            this.elements.recordCount.textContent = this.totalRecords.toLocaleString();
        }
        
        updateFilterBadge() {
            const filterCount = Object.keys(this.filters).length;
            this.elements.filterBadge.textContent = filterCount;
            this.elements.filterBadge.style.display = filterCount > 0 ? 'inline-flex' : 'none';
        }
        
        previousPage() {
            if (this.currentPage > 1) {
                this.currentPage--;
                this.loadData();
            }
        }
        
        nextPage() {
            const totalPages = Math.ceil(this.totalRecords / this.pageSize);
            if (this.currentPage < totalPages) {
                this.currentPage++;
                this.loadData();
            }
        }
        
        sortBy(column) {
            if (this.sortColumn === column) {
                this.sortDirection = this.sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                this.sortColumn = column;
                this.sortDirection = 'asc';
            }
            
            this.loadData();
        }
        
        applyCurrentFilters() {
            // Collect filter values
            this.filters = {};
            
            // Status filters
            const statusFilters = [];
            document.querySelectorAll('input[name="status"]:checked').forEach(cb => {
                statusFilters.push(cb.value);
            });
            if (statusFilters.length > 0) {
                this.filters.status = statusFilters;
            }
            
            // Date range filters
            const dateFrom = document.getElementById('date-from').value;
            const dateTo = document.getElementById('date-to').value;
            if (dateFrom) this.filters.dateFrom = dateFrom;
            if (dateTo) this.filters.dateTo = dateTo;
            
            this.updateFilterBadge();
            this.currentPage = 1;
            this.loadData();
            this.elements.filterMenu.classList.remove('show');
        }
        
        clearAllFilters() {
            this.filters = {};
            document.querySelectorAll('input[name="status"]').forEach(cb => {
                cb.checked = true;
            });
            document.getElementById('date-from').value = '';
            document.getElementById('date-to').value = '';
            
            this.updateFilterBadge();
            this.currentPage = 1;
            this.loadData();
        }
        
        debouncedSearch = this.debounce((searchTerm) => {
            this.filters.search = searchTerm;
            this.currentPage = 1;
            this.loadData();
        }, 300);
        
        // Utility methods
        debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }
        
        formatTime(timeString) {
            return timeString || '-';
        }
        
        // Action methods (to be implemented)
        openAddRecordModal() {
            console.log('Open add record modal');
            // Implement modal opening
        }
        
        editRecord(recordId) {
            console.log('Edit record:', recordId);
            // Implement edit functionality
        }
        
        deleteRecord(recordId) {
            if (confirm('Are you sure you want to delete this record?')) {
                console.log('Delete record:', recordId);
                // Implement delete functionality
                this.loadData();
            }
        }
        
        viewRecord(recordId) {
            console.log('View record:', recordId);
            // Implement view functionality
        }
        
        bulkEdit() {
            console.log('Bulk edit:', Array.from(this.selectedRecords));
            // Implement bulk edit
        }
        
        bulkDelete() {
            if (confirm(`Delete ${this.selectedRecords.size} selected records?`)) {
                console.log('Bulk delete:', Array.from(this.selectedRecords));
                // Implement bulk delete
                this.selectedRecords.clear();
                this.loadData();
            }
        }
        
        bulkExport() {
            console.log('Bulk export:', Array.from(this.selectedRecords));
            // Implement bulk export
        }
        
        showErrorState() {
            const tbody = this.elements.tableBody;
            tbody.innerHTML = `
                <tr class="error-row">
                    <td colspan="7">
                        <div class="error-state">
                            <i class="icon-error"></i>
                            <p>Failed to load attendance records</p>
                            <button class="btn btn-primary" id="retry-load">Retry</button>
                        </div>
                    </td>
                </tr>
            `;
            
            document.getElementById('retry-load')?.addEventListener('click', () => {
                this.loadData();
            });
        }
    }
    
    // Initialize when component loads
    document.addEventListener('DOMContentLoaded', () => {
        if (document.querySelector('[data-component="attendance-table"]')) {
            window.attendanceTable = new AttendanceTable();
        }
    });
</script>
